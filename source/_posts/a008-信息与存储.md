---
title: 信息与存储
categories:
  - 前端学习
tags:
  - cookies
  - session
  - token
  - H5本地存储
date: 2022-07-12 10:44:45
index_img: https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic4.zhimg.com%2Fv2-8af4f72c16e0cf906027ed41f5e20e17_b.jpg&refer=http%3A%2F%2Fpic4.zhimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1660188325&t=f2070b56c0dfc213e52ca02de17990af
---
参考视频：[BV1UA411H77k](https://www.bilibili.com/video/BV1UA411H77k?spm_id_from=333.999.0.0)

---
### 信息
#### cookies
1. 关于cookies
  >cookies不是缓存;
  >
  >当 web 服务器向浏览器发送网页后，连接被关闭，服务器会忘记用户的一切，Cookie 是为了解决记住用户信息发明的;
  >
  >使得基于无状态的http协议记录稳定的状态信息成为可能；
  >
  >格式为键值对，名字自定义;
  >
  >{key,value,domain,path,exprits,size};
  >
  >第一次访问服务器通过响应头的set-cookie发送到用户浏览器并保存在本地的一小块数据;
  >
  >它会在浏览器之后向同一服务器再次发送请求时被携带在http请求头Cookie并发送到服务器;

![原理图](https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic4.zhimg.com%2Fv2-8af4f72c16e0cf906027ed41f5e20e17_b.jpg&refer=http%3A%2F%2Fpic4.zhimg.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1660188325&t=f2070b56c0dfc213e52ca02de17990af)

2. cookie的作用
>记录用户的登录状态，购物车的状态
>
>主题风格等个性化的设置

3. cookie的分类：
>会话级cookie：保存在内存，当前域名关闭时自动失效
>
>持久级cookie：保存在硬盘，当失效时间到了自动失效；
>存储位置：C:\Users\Public(公用)\AppData\Local\Google\Chrome\User Data\Default

4. cookie的特点
>每一个域名只会存4k大小
>
>保存在客户端，不安全
>
>主domain污染，子域名发送请求时也会带上主域名的信息，造成臃肿
>
>查看cookie：当前网页(开发者工具)，所有cookie(设置)
>
>客户端状态管理技术：将状态存放在客户端。


#### session
1. 关于session
>当我们用户第一次登录之后，在服务器就会生成一个会话标识(sessionid),并保存在服务器的内存中，默认保存30分钟
>
>这个sessionid会通过set-cookie发送给客户端保存，下次访问通过cookie将sessionid传输给服务器，服务器就知道你是哪个用户
>
>所以cookie中就不用保存用户密码等信息，只需保存sessionid就可以了
>
>sessionid一般是通过会话级cookie保存和传输，提高了安全性

2. session特点
>服务器状态管理技术：将状态存放在服务器中
>
>增加了服务器的负担，影响服务器性能
>解决：可以配置多台服务器
>
>用户每次访问不同的服务器，且并不是每台服务器都记录了sessionid
>解决1：ip捆绑(每次只访问同一台服务器)
>
>解决2：session复制(每台服务器都复制一份相同的sessionid)
>
>解决3：单点登录(所有用户都只请求单点登录服务器，所有的sessionid都保存在单点服务器上，之后分发请求)
>缺点：用户过多还是会崩溃，sessionid可以被伪造

![原理图](https://img-blog.csdnimg.cn/20210301190137744.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ2NjIwMTI5,size_16,color_FFFFFF,t_70#pic_center)


#### token
1. token原理
>用户登录成功后，服务器生成一个令牌(token)，里面包含了userid等用户信息，保存在服务器的文本文档或数据库中
>
>服务器再将token发送给客户端，本地可以存储起来
>
>客户端每次向服务端请求资源的时候需要带着服务端签发的token
>
>服务端收到请求，然后去验证客户端请求里面带着的token，如果验证成功，就向客户端返回请求的数据
>
>客户端和服务器端之间的token验证是通过人为的加密的约定

![原理图](https://img-blog.csdnimg.cn/20200904225849315.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ0NzYyMjY3,size_16,color_FFFFFF,t_70#pic_center)

2. 加密方式
|对称加密解密|双钥加密解密|只加密不解密|
|--|--|--|
|DES、AES|RSA|MD5、SHA系列|
>缺点：金融项目、银行项目、第三方支付项目加密要求达不到
>方法：签名和数字证书，主要用于接口测试


#### 三者的区别与联系
**相同点：**
+   都是在服务器产生的，都用于身份验证
+   用于客户端和服务器端状态保持的
+   请求接口都需要，cookie和session在请求头中，token在接口参数中

**不同点：**
+   cookie存储在客户端，session存储在服务器内存，默认30分钟，session安全性高于cookie，重要数据放session，次要数据放cookie；
+   token存储在服务器数据库中，比session更加节约服务器资源


### 存储
#### H5本地存储
>localstorage 永久存储本地域名，除非手动删除，不同域名及子域名不共享
>
>sessionstorage 关闭当前会话即消失，不同域名及相同域名子域名不共享
>
>server端拿不到本地存储的信息，不会被拦截，可以通过地址拼接获取
>
>存储大小为5m
>
>利用本地存储，可以减少网络传输


#### indexedDB和webSQL
>一种能在浏览器中持久的存储结构化数据的数据库，并为web应用提供了丰富的查询能力
>
>按照域名分配独立空间，一个独立域名下可以创建多个数据库，每个数据库可以创建多个对象存储空间(表)，一个存储空间可以存储多个对象数据


#### H5离线缓存
>让web应用在离线的情况下继续使用，通过manifest文件指明需要缓存的资源
