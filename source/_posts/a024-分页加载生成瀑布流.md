---
title: 分页加载生成瀑布流
categories:
  - 前端学习
tags:
  - 瀑布流
date: 2023-05-14 15:24:12
index_img: https://img1.baidu.com/it/u=779295136,1495840078&fm=253&fmt=auto&app=138&f=PNG?w=1142&h=470
---

### 效果

<img src="/img/sample/a024/a024.gif" alt="">

### 描述

列表数据展示成瀑布流，分页加载更多
新的数据自动添加到较矮的那一列最后

### 代码部分

App.jsx

```javascript
import React, {
    Component
} from 'react';
import './App.less'

function random(start, end) {
    return Math.random() * (end - start) + start;
}

function debounce(fn, delay) {
    let timer = null
    return function() {
        clearTimeout(timer)
        timer = setTimeout(() => {
            fn.apply(this, arguments)
        }, delay)
    }
}

class App extends Component {
    count = 0
    componentDidMount() {
        this.addNew(20)
    }

    addNew = (times) => {
        let masonry = document.getElementById("masonry");
        let columns = masonry.querySelectorAll(".masonry-column");
        let minHeightColumn = columns[0];
        for (let i = this.count; i < times + this.count; i++) {
            columns.forEach(ele => {
                if (ele.clientHeight < minHeightColumn.clientHeight) {
                    minHeightColumn = ele;
                }
            });
            let newItem = document.createElement('div');
            newItem.classList.add('item');
            newItem.style.height = `${Math.random() * 200 + 70}px`;
            newItem.style.backgroundColor = `rgb(${random(0, 255)},${random(0, 255)},${random(0, 255)})`
            newItem.innerHTML = i + 1
            minHeightColumn.appendChild(newItem);
        }
        this.count += times
    }
    render() {
        return (       
        <div
        className='App'
        onScroll={debounce((evt) => {
          let scrollTop = evt.target.scrollTop
          let scrollHeight = evt.target.scrollHeight
          let clientHeight = evt.target.clientHeight
          if (scrollHeight - clientHeight - scrollTop < 200) {
            this.addNew(20)
          }
        }, 200)}
        >
          <div id="masonry">
            <div className="masonry-column-container">
              <div className="masonry-column"></div>
            </div>
            <div className="masonry-column-container">
              <div className="masonry-column"></div>
            </div>
            <div className="masonry-column-container">
              <div className="masonry-column"></div>
            </div>
          </div>
        </div>
        );
    }
}

export default App;
```

App.less

```less
html,
body,
#root {
    height: 100%;
    overflow: hidden;
}

.App {
    height: 100%;
    overflow-y: auto;
}

#masonry {
    margin: 0 auto;
    width: 100%;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
}

#masonry .masonry-column {
    position: relative;
}

#masonry .item {
    width: 100%;
    margin-top: 10px;
    border-radius: 1em;
    display: flex;
    align-items: center;
    justify-content: center;
}
```
